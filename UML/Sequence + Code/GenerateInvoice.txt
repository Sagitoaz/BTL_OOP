@startuml
title Generate Invoice

actor Staff as "Staff/Doctor"
boundary UI
control Service
database Database

Staff -> UI: Request to generate invoice
UI -> Service: Generate invoice request\n(services, drugs)
activate Service

alt Missing price / insurance configuration
  Service -> Service: Validate input & pricing/insurance
  Service -> Database: Check price/insurance config
  Database --> Service: Missing / invalid config
  Service --> UI: Configuration error\n(missing price / insurance)
else Complete information
  Service -> Service: Calculate charges\n(services, drugs, insurance)
  Service -> Database: Insert invoice & items
  Database --> Service: Invoice ID
  Service --> UI: Invoice created\n(+ optional PDF link)
end
deactivate Service

UI --> Staff: Display invoice or error
@enduml