@startuml Change Password Flow
actor User
boundary UI
control Service
database DB

User -> UI: Click Change Password Button
UI --> User: Show Change Password Form

User -> UI: Enter Old Password
User -> UI: Enter New Password
User -> UI: Confirm New Password

' --- Main flow ---
alt Normal change password flow
    alt New Password Format Invalid
        UI --> User: 400 Bad Request (Password format invalid)
    else New Passwords Don't Match
        UI --> User: 400 Bad Request (Passwords mismatch)
    else Passwords Valid
        UI -> Service: Send Password Change Request
        Service -> DB: Validate User Credentials
        DB --> Service: 200 OK (Validation result)

        alt User and Old Password Correct
            Service -> DB: Update Password
            DB --> Service: 200 OK (Updated)
            Service --> UI: 200 OK (Change password success)
            UI --> User: Show Success Message
        else User or Old Password Incorrect
            Service --> UI: 401 Unauthorized (Old password incorrect)
            UI --> User: Show Error Message
        end
    end
end

' --- System exception (separate block to tránh lỗi cú pháp) ---
alt Exception
    Service --> UI: 500 Internal Server Error
    UI --> User: Display Error Message
end
@enduml
