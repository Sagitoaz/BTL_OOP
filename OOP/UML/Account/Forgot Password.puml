@startuml
title Forgot Password Flow
actor User
boundary UI
control "Auth Service" as Service
database DB
control "Mail Service" as Mail

User -> UI: Forgot Password request
UI -> Service: Request Forgot Password (email)
activate Service

Service -> DB: Query: check if email exists
DB --> Service: QueryResult (exists / not exists)

alt Email exists
    Service -> Mail: Send Reset Password Email
    Mail --> User: Receive Reset Password Email
    Service --> UI: 200 OK (message: "Check your email")
    UI --> User: Show "Check your email" message
else Email not found
    Service --> UI: 404 Not Found (message: "Email not registered")
    UI --> User: Show "Email not found" message
end
deactivate Service

alt Validation / rate / infra errors
    alt Invalid email format
        Service --> UI: 400 Bad Request (invalid email)
    else Too many requests
        Service --> UI: 429 Too Many Requests
    else Mail delivery failed / bounce
        Service --> UI: 502 Bad Gateway (mail service failed) or 500
    else DB query timeout / DB connection error
        Service --> UI: 503 Service Unavailable / 504 Gateway Timeout
    end
    UI --> User: Display error message
end
@enduml