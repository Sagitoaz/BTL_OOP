<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>
<?import javafx.collections.FXCollections?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.CheckBox?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.TitledPane?>
<?import javafx.scene.control.ToolBar?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Pane?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.layout.VBox?>

<BorderPane prefHeight="640.0" prefWidth="900.0" xmlns="http://javafx.com/javafx/24.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="org.example.oop.Control.Inventory.AddInventoryController">

    <!-- HEADER -->
    <top>
        <VBox spacing="6">
            <padding>
                <Insets bottom="0" left="12" right="12" top="12" />
            </padding>
            <Label style="-fx-font-size: 16px; -fx-font-weight: bold;" text="Add Inventory (Product + Optional Initial Stock)" />
            <Separator />
        </VBox>
    </top>

    <!-- BODY -->
    <center>
        <TabPane tabClosingPolicy="UNAVAILABLE">
            <!-- TAB 1: PRODUCT INFO -->
            <Tab text="Product Info">
                <ScrollPane fitToHeight="true" fitToWidth="true">
                    <content>
                        <VBox spacing="12">
                            <padding>
                                <Insets bottom="12" left="12" right="12" top="12" />
                            </padding>

                            <!-- BASIC INFORMATION -->
                            <TitledPane expanded="true" text="Basic Information">
                                <content>
                                    <GridPane hgap="10" vgap="10">
                                        <columnConstraints>
                                            <ColumnConstraints prefWidth="160" />
                                            <ColumnConstraints hgrow="ALWAYS" />
                                        </columnConstraints>

                                        <!-- SKU -->
                                        <Label text="SKU:" GridPane.columnIndex="0" GridPane.halignment="RIGHT" GridPane.rowIndex="0" />
                                        <TextField fx:id="tfSku" promptText="Mã hàng duy nhất" GridPane.columnIndex="1" GridPane.rowIndex="0" />

                                        <!-- Name -->
                                        <Label text="Name:" GridPane.columnIndex="0" GridPane.halignment="RIGHT" GridPane.rowIndex="1" />
                                        <TextField fx:id="tfName" promptText="Tên hiển thị" GridPane.columnIndex="1" GridPane.rowIndex="1" />

                                        <!-- Category -->
                                        <Label text="Category:" GridPane.columnIndex="0" GridPane.halignment="RIGHT" GridPane.rowIndex="2" />
                                        <ComboBox fx:id="cbCategory" prefWidth="220" GridPane.columnIndex="1" GridPane.rowIndex="2">
                                            <items>
                                                <FXCollections fx:factory="observableArrayList">
                                                    <String fx:value="frame" />
                                                    <String fx:value="lens" />
                                                    <String fx:value="contact_lens" />
                                                    <String fx:value="machine" />
                                                    <String fx:value="consumable" />
                                                    <String fx:value="service" />
                                                </FXCollections>
                                            </items>
                                        </ComboBox>

                                        <!-- Unit -->
                                        <Label text="Unit:" GridPane.columnIndex="0" GridPane.halignment="RIGHT" GridPane.rowIndex="3" />
                                        <TextField fx:id="tfUnit" promptText="chiếc, hộp, dịch vụ..." GridPane.columnIndex="1" GridPane.rowIndex="3" />
                              <rowConstraints>
                                 <RowConstraints />
                                 <RowConstraints />
                                 <RowConstraints />
                                 <RowConstraints />
                              </rowConstraints>
                                    </GridPane>
                                </content>
                            </TitledPane>

                            <!-- PRICING -->
                            <TitledPane expanded="true" text="Pricing">
                                <content>
                                    <GridPane hgap="10" vgap="10">
                                        <columnConstraints>
                                            <ColumnConstraints prefWidth="160" />
                                            <ColumnConstraints hgrow="ALWAYS" />
                                        </columnConstraints>

                                        <!-- Price Cost -->
                                        <Label text="Price Cost:" GridPane.columnIndex="0" GridPane.halignment="RIGHT" GridPane.rowIndex="0" />
                                        <TextField fx:id="tfPriceCost" promptText="Giá nhập (số nguyên)" GridPane.columnIndex="1" GridPane.rowIndex="0" />

                                        <!-- Price Retail -->
                                        <Label text="Price Retail:" GridPane.columnIndex="0" GridPane.halignment="RIGHT" GridPane.rowIndex="1" />
                                        <TextField fx:id="tfPriceRetail" promptText="Giá bán lẻ mặc định" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                              <rowConstraints>
                                 <RowConstraints />
                                 <RowConstraints />
                              </rowConstraints>
                                    </GridPane>
                                </content>
                            </TitledPane>

                            <!-- STATUS & META -->
                            <TitledPane expanded="true" text="Status &amp; Meta">
                                <content>
                                    <GridPane hgap="10" vgap="10">
                                        <columnConstraints>
                                            <ColumnConstraints prefWidth="160" />
                                            <ColumnConstraints hgrow="ALWAYS" />
                                        </columnConstraints>

                                        <!-- Active -->
                                        <Label text="Active:" GridPane.columnIndex="0" GridPane.halignment="RIGHT" GridPane.rowIndex="0" />
                                        <CheckBox fx:id="chkActive" selected="true" GridPane.columnIndex="1" GridPane.rowIndex="0" />

                                        <!-- ID (read-only khi edit) -->
                                        <Label text="ID:" GridPane.columnIndex="0" GridPane.halignment="RIGHT" GridPane.rowIndex="1" />
                                        <TextField fx:id="tfId" editable="false" promptText="(auto)" GridPane.columnIndex="1" GridPane.rowIndex="1" />

                                        <!-- Created At (read-only) -->
                                        <Label text="Created At:" GridPane.columnIndex="0" GridPane.halignment="RIGHT" GridPane.rowIndex="2" />
                                        <TextField fx:id="tfCreatedAt" editable="false" promptText="auto" GridPane.columnIndex="1" GridPane.rowIndex="2" />
                              <rowConstraints>
                                 <RowConstraints />
                                 <RowConstraints />
                                 <RowConstraints />
                              </rowConstraints>
                                    </GridPane>
                                </content>
                            </TitledPane>

                            <!-- NOTE -->
                            <TitledPane expanded="false" text="Note">
                                <content>
                                    <VBox spacing="6">
                                        <TextArea fx:id="taNote" prefRowCount="3" promptText="Ghi chú" />
                                    </VBox>
                                </content>
                            </TitledPane>

                            <!-- ACTIONS -->
                            <HBox alignment="CENTER_RIGHT" spacing="8">
                                <Button fx:id="btnResetProduct" text="Reset" />
                                <Button fx:id="btnSaveProduct" text="Save Product" />
                            </HBox>
                        </VBox>
                    </content>
                </ScrollPane>
            </Tab>

            <!-- TAB 2: OPTIONAL INITIAL STOCK (ghi nhận tồn đầu kỳ) -->
            <Tab text="Initial Stock (Optional)">
                <VBox spacing="8">
                    <padding>
                        <Insets bottom="12" left="12" right="12" top="12" />
                    </padding>

                    <!-- Chọn sản phẩm vừa tạo hoặc sản phẩm có sẵn -->
                    <ToolBar>
                        <Label text="Product:" />
                        <ComboBox fx:id="cbInitProduct" prefWidth="420" promptText="Chọn sản phẩm để nhập tồn đầu kỳ" />
                        <Separator orientation="VERTICAL" />
                        <Label text="Total Qty:" />
                        <Label fx:id="lblInitTotalQty" style="-fx-font-weight: bold;" text="0" />
                        <Pane HBox.hgrow="ALWAYS" />
                        <Button fx:id="btnAddLine" text="Add Line" />
                        <Button fx:id="btnRemoveLine" text="Remove Selected" />
                        <Button fx:id="btnImportCsv" text="Import CSV" />
                    </ToolBar>

                    <!-- Bảng nhập nhiều dòng (batch/expiry/serial/qty) -->
                    <TableView fx:id="tblInitLines" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="colBatch" prefWidth="112.79998207092285" text="Batch No" />
                            <TableColumn fx:id="colExpiry" prefWidth="129.59996795654297" text="Expiry Date" />
                            <TableColumn fx:id="colSerial" prefWidth="151.20001220703125" text="Serial No" />
                            <TableColumn fx:id="colQty" prefWidth="102.39996337890625" text="Qty" />
                            <TableColumn fx:id="colRefid" prefWidth="120" text="Ref ID" />
                            <TableColumn fx:id="colRed" prefWidth="120" text="Red" />
                            <TableColumn fx:id="colLineNote" prefWidth="200" text="Note" />
                        </columns>
                        <placeholder>
                            <Label text="Chưa có dòng nào. Nhấn Add Line để thêm." />
                        </placeholder>
                    </TableView>

                    <!-- Người thao tác và thời điểm -->
                    <GridPane hgap="10" vgap="10">
                        <padding>
                            <Insets bottom="6" left="6" right="6" top="6" />
                        </padding>
                        <columnConstraints>
                            <ColumnConstraints prefWidth="160" />
                            <ColumnConstraints hgrow="ALWAYS" />
                        </columnConstraints>

                        <Label text="Moved By (user id):" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                        <TextField fx:id="tfInitMovedBy" promptText="User ID" GridPane.columnIndex="1" GridPane.rowIndex="0" />

                        <Label text="Moved At:" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                        <HBox spacing="6" GridPane.columnIndex="1" GridPane.rowIndex="1">
                            <DatePicker fx:id="dpInitMovedDate" promptText="yyyy-MM-dd" />
                            <TextField fx:id="tfInitMovedTime" promptText="HH:mm:ss" />
                        </HBox>
                  <rowConstraints>
                     <RowConstraints />
                     <RowConstraints />
                  </rowConstraints>
                    </GridPane>

                    <HBox spacing="8">
                        <Button fx:id="btnSaveInitialStock" text="Save Initial Stock" />
                        <Button fx:id="btnResetInitialStock" text="Reset" />
                    </HBox>
                </VBox>
            </Tab>
        </TabPane>
    </center>

    <!-- FOOTER -->
    <bottom>
        <HBox alignment="CENTER_LEFT" spacing="12">
            <padding>
                <Insets bottom="12" left="12" right="12" top="8" />
            </padding>
            <Label text="Status:" />
            <Label fx:id="lblStatus" text="Ready" />
            <Pane HBox.hgrow="ALWAYS" />
            <Button fx:id="btnClose" text="Close" />
        </HBox>
    </bottom>
</BorderPane>
