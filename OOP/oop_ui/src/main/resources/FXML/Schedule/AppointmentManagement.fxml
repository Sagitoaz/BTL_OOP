<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.CheckBox?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.MenuButton?>
<?import javafx.scene.control.MenuItem?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.SplitPane?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.layout.VBox?>

<BorderPane prefHeight="800.0" prefWidth="1200.0" styleClass="main-container" stylesheets="@../../css/main.css,@../../css/forms.css,@../../css/buttons.css,@../../css/layouts.css,@../../css/financial-report.css,@../../css/navigation.css,@../../css/global-styles.css,@../../css/tables.css" xmlns="http://javafx.com/javafx/24.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="org.example.oop.Control.Schedule.AppointmentManagementController">

    <top>
        <VBox>
            <!-- Navigation Bar -->
            <HBox alignment="CENTER_LEFT" spacing="8" style="-fx-padding: 12px 20px;" styleClass="navigation-bar">
                <Button fx:id="backButton" onAction="#handleBackButton" styleClass="nav-button nav-back-button" text="â—€ Quay láº¡i" />
                <Button fx:id="forwardButton" onAction="#handleForwardButton" styleClass="nav-button nav-forward-button" text="Tiáº¿n â–¶" />
                <Button fx:id="reloadButton" onAction="#handleReloadButton" styleClass="nav-button nav-reload-button" text="âŸ³ Táº£i láº¡i" />
            </HBox>

            <!-- Header with gradient -->
            <HBox alignment="CENTER_LEFT" spacing="16.0" style="-fx-background-color: linear-gradient(to right, #0EA5E9, #0284C7); -fx-padding: 20px 24px; -fx-effect: dropshadow(gaussian, rgba(14,165,233,0.3), 15, 0, 0, 4);" styleClass="financial-header">
                <padding>
                    <Insets bottom="18.0" left="28.0" right="28.0" top="18.0" />
                </padding>
                <Label styleClass="page-title" text="QUáº¢N LÃ Lá»ŠCH Háº¸N" />
                <Region HBox.hgrow="ALWAYS" />
                <Button fx:id="createPrescriptionBtn" mnemonicParsing="false" onAction="#onCreatePrescription" prefHeight="49.0" prefWidth="206.0" styleClass="btn-success" text="ðŸ“‹ Táº¡o Ä‘Æ¡n khÃ¡m" textAlignment="CENTER" />
                <Button fx:id="createBtn" mnemonicParsing="false" onAction="#onCreate" prefHeight="44.0" prefWidth="170.0" styleClass="btn-success" text="Táº¡o háº¹n" textAlignment="CENTER" />
            </HBox>

            <Separator />

            <VBox spacing="8.0">
                <padding>
                    <Insets bottom="12.0" left="28.0" right="28.0" top="12.0" />
                </padding>

                <!-- Row 1: Date and Filters -->
                <HBox alignment="CENTER_LEFT" spacing="12.0">
                    <Label styleClass="form-label" text="Lá»c:" />
                    <DatePicker fx:id="fromDatePicker" prefHeight="45.0" prefWidth="155.0" promptText="Tá»« ngÃ y" />
                    <DatePicker fx:id="toDatePicker" prefHeight="45.0" prefWidth="155.0" promptText="Äáº¿n ngÃ y" />
                    <ComboBox fx:id="doctorFilter" prefWidth="160.0" promptText="BÃ¡c sÄ©" styleClass="combo-rounded" />
                    <ComboBox fx:id="roomFilter" prefWidth="140.0" promptText="PhÃ²ng" styleClass="combo-rounded" />
                    <ComboBox fx:id="statusFilter" prefWidth="140.0" promptText="Tráº¡ng thÃ¡i" styleClass="combo-rounded" />
                    <TextField fx:id="qSearch" prefWidth="200" promptText="TÃ¬m BN/SÄT/MÃ£ háº¹n" styleClass="text-field" />
                </HBox>

                <!-- Row 2: Action Buttons -->
                <HBox alignment="CENTER_LEFT" spacing="12.0">
                    <padding>
                        <Insets top="8.0" />
                    </padding>
                    <Button fx:id="applyFilterBtn" mnemonicParsing="false" onAction="#onApplyFilter" prefWidth="119.0" styleClass="btn-secondary" text="ðŸ” Lá»c" />
                    <Button fx:id="resetFilterBtn" mnemonicParsing="false" onAction="#onResetFilter" prefHeight="49.0" prefWidth="135.0" styleClass="btn-secondary" text="XÃ³a lá»c" />

                    <Region prefWidth="20.0" />

                    <Button fx:id="confirmBtn" mnemonicParsing="false" onAction="#onConfirm" prefHeight="49.0" prefWidth="136.0" styleClass="btn-success" text="âœ“ Duyá»‡t" />
                    <Button fx:id="cancelBtn" mnemonicParsing="false" onAction="#onCancel" prefWidth="120.0" styleClass="btn-delete" text="âœ— Há»§y" />
                    <MenuButton fx:id="moreActionsBtn" mnemonicParsing="false" prefHeight="58.0" prefWidth="180.0" styleClass="btn-secondary" text="â‹¯ Thao tÃ¡c">
                        <items>
                            <MenuItem mnemonicParsing="false" text="Chuyá»ƒn bÃ¡c sÄ©..." />
                            <MenuItem mnemonicParsing="false" text="Gá»­i SMS..." />
                            <MenuItem mnemonicParsing="false" text="Xuáº¥t CSV..." />
                        </items>
                    </MenuButton>
                </HBox>
            </VBox>
        </VBox>
    </top>

    <center>
        <SplitPane dividerPositions="0.65" focusTraversable="false" prefHeight="160.0" prefWidth="200.0" BorderPane.alignment="CENTER">
            <items>
                <VBox spacing="12.0">
                    <padding>
                        <Insets bottom="16.0" left="16.0" right="16.0" top="16.0" />
                    </padding>
                    <HBox alignment="CENTER_LEFT" spacing="12.0">
                        <Label styleClass="form-label" text="Danh sÃ¡ch háº¹n" />
                        <Region HBox.hgrow="ALWAYS" />
                        <CheckBox mnemonicParsing="false" text="Chá»‰ hiá»‡n xung Ä‘á»™t" />
                        <Button fx:id="refreshBtn" mnemonicParsing="false" onAction="#onRefresh" prefHeight="44.0" prefWidth="145.0" styleClass="btn-secondary" text="LÃ m má»›i" textAlignment="CENTER" />
                    </HBox>

                    <TableView fx:id="appointmentTable" styleClass="financial-table" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="colId" prefWidth="60.0" text="ID" />
                            <TableColumn fx:id="colTime" prefWidth="120.0" text="Thá»i gian" />
                            <TableColumn fx:id="colDate" prefWidth="100.0" text="NgÃ y" />
                            <TableColumn fx:id="colPatient" prefWidth="180.0" text="Bá»‡nh nhÃ¢n" />
                            <TableColumn fx:id="colDoctor" prefWidth="160.0" text="BÃ¡c sÄ©" />
                            <TableColumn fx:id="colService" prefWidth="150.0" text="Dá»‹ch vá»¥" />
                            <TableColumn fx:id="colRoom" prefWidth="100.0" text="PhÃ²ng" />
                            <TableColumn fx:id="colStatus" prefWidth="120.0" text="Tráº¡ng thÃ¡i" />
                            <TableColumn fx:id="colNote" prefWidth="180.0" text="Ghi chÃº" />
                        </columns>
                        <placeholder>
                            <VBox alignment="CENTER" spacing="10">
                                <padding>
                                    <Insets bottom="40" left="40" right="40" top="40" />
                                </padding>
                                <Label text="ChÆ°a cÃ³ lá»‹ch háº¹n" />
                                <Label text="Táº¡o lá»‹ch háº¹n má»›i Ä‘á»ƒ báº¯t Ä‘áº§u" />
                            </VBox>
                        </placeholder>
                    </TableView>

                    <!-- Summary Label -->
                    <HBox alignment="CENTER_LEFT" spacing="10" style="-fx-padding: 10 0 0 0;">
                        <Label fx:id="lblSummary" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #0369A1;" text="Tá»•ng: 0 lá»‹ch háº¹n" />
                    </HBox>
                </VBox>

                <TabPane styleClass="financial-tabs" tabClosingPolicy="UNAVAILABLE">
                    <tabs>
                        <Tab text="ðŸ“ Chi tiáº¿t">
                            <ScrollPane fitToWidth="true" styleClass="scroll-pane">
                                <VBox spacing="16.0">
                                    <padding>
                                        <Insets bottom="16.0" left="16.0" right="16.0" top="16.0" />
                                    </padding>
                                    <GridPane hgap="12.0" vgap="14.0">
                                        <columnConstraints>
                                            <ColumnConstraints halignment="RIGHT" minWidth="100" />
                                            <ColumnConstraints hgrow="ALWAYS" />
                                        </columnConstraints>

                                        <Label styleClass="form-label" text="MÃ£ háº¹n:" GridPane.rowIndex="0" />
                                        <TextField fx:id="txtId" editable="false" styleClass="text-field" GridPane.columnIndex="1" GridPane.rowIndex="0" />

                                        <Label styleClass="form-label" text="NgÃ y:" GridPane.rowIndex="1" />
                                        <DatePicker fx:id="datePicker" maxWidth="Infinity" GridPane.columnIndex="1" GridPane.rowIndex="1" />

                                        <Label styleClass="form-label" text="Giá» báº¯t Ä‘áº§u:" GridPane.rowIndex="2" />
                                        <TextField fx:id="startTimeField" styleClass="text-field" GridPane.columnIndex="1" GridPane.rowIndex="2" />

                                        <Label styleClass="form-label" text="Giá» káº¿t thÃºc:" GridPane.rowIndex="3" />
                                        <TextField fx:id="endTimeField" styleClass="text-field" GridPane.columnIndex="1" GridPane.rowIndex="3" />

                                        <Label styleClass="form-label" text="Bá»‡nh nhÃ¢n:" GridPane.rowIndex="4" />
                                        <HBox spacing="8.0" GridPane.columnIndex="1" GridPane.rowIndex="4">
                                            <TextField fx:id="patientField" editable="false" styleClass="text-field" HBox.hgrow="ALWAYS" />
                                        </HBox>

                                        <Label styleClass="form-label" text="BÃ¡c sÄ©:" GridPane.rowIndex="6" />
                                        <ComboBox fx:id="doctorCombo" maxWidth="Infinity" styleClass="combo-rounded" GridPane.columnIndex="1" GridPane.rowIndex="6" />

                                        <Label styleClass="form-label" text="Dá»‹ch vá»¥:" GridPane.rowIndex="7" />
                                        <ComboBox fx:id="serviceCombo" maxWidth="Infinity" styleClass="combo-rounded" GridPane.columnIndex="1" GridPane.rowIndex="7" />

                                        <Label styleClass="form-label" text="PhÃ²ng:" GridPane.rowIndex="8" />
                                        <ComboBox fx:id="roomCombo" maxWidth="Infinity" styleClass="combo-rounded" GridPane.columnIndex="1" GridPane.rowIndex="8" />

                                        <Label styleClass="form-label" text="Tráº¡ng thÃ¡i:" GridPane.rowIndex="9" />
                                        <ComboBox fx:id="statusCombo" maxWidth="Infinity" styleClass="combo-rounded" GridPane.columnIndex="1" GridPane.rowIndex="9" />

                                        <Label styleClass="form-label" text="Ghi chÃº:" GridPane.rowIndex="10" GridPane.valignment="TOP">
                                            <padding><Insets top="8.0" /></padding>
                                        </Label>
                                        <TextArea fx:id="noteArea" prefRowCount="3" styleClass="text-area" GridPane.columnIndex="1" GridPane.rowIndex="10" />
                                         <Button fx:id="choosePatientBtn" onAction="#onChoosePatient" prefHeight="40.0" prefWidth="123.0" styleClass="btn-apply" text="Chá»n..." GridPane.columnIndex="1" GridPane.rowIndex="5">
                                 <GridPane.margin>
                                    <Insets />
                                 </GridPane.margin>
                              </Button>
                           <rowConstraints>
                              <RowConstraints />
                              <RowConstraints />
                              <RowConstraints />
                              <RowConstraints />
                              <RowConstraints />
                              <RowConstraints />
                              <RowConstraints />
                              <RowConstraints />
                              <RowConstraints />
                              <RowConstraints />
                                 <RowConstraints />
                           </rowConstraints>
                                    </GridPane>

                                    <Separator />

                                    <VBox spacing="12.0">
                                        <Button fx:id="saveBtn" maxWidth="Infinity" onAction="#onSave" styleClass="btn-success" text="LÆ°u" />
                                        <Button fx:id="revertBtn" maxWidth="Infinity" onAction="#onRevert" styleClass="btn-secondary" text="HoÃ n tÃ¡c" />
                                        <Button fx:id="deleteBtn" maxWidth="Infinity" onAction="#onDelete" styleClass="btn-danger" text="XÃ³a háº¹n" />
                                    </VBox>
                                </VBox>
                            </ScrollPane>
                        </Tab>

                        <Tab text="ðŸ“… Timeline">
                            <VBox spacing="12.0">
                                <padding>
                                    <Insets bottom="16.0" left="16.0" right="16.0" top="16.0" />
                                </padding>
                                <Label styleClass="form-label" text="Diá»…n tiáº¿n:" />
                                <ListView fx:id="timelineList" VBox.vgrow="ALWAYS" />
                                <HBox alignment="CENTER_RIGHT" spacing="12.0">
                                    <Button fx:id="sendSmsBtn" onAction="#onSendSms" prefHeight="49.0" prefWidth="187.0" styleClass="btn-secondary" text="SMS nháº¯c háº¹n" />
                                    <Button fx:id="sendEmailBtn" onAction="#onSendEmail" prefHeight="49.0" prefWidth="162.0" styleClass="btn-secondary" text="Gá»­i Email" />
                                </HBox>
                            </VBox>
                        </Tab>

                        <Tab text="ðŸ“ Ghi chÃº">
                            <VBox spacing="12.0">
                                <padding>
                                    <Insets bottom="16.0" left="16.0" right="16.0" top="16.0" />
                                </padding>
                                <TextArea fx:id="extraNoteArea" styleClass="text-area" VBox.vgrow="ALWAYS" />
                                <HBox alignment="CENTER_RIGHT">
                                    <Button fx:id="saveNoteBtn" onAction="#onSaveNote" prefHeight="49.0" prefWidth="182.0" styleClass="btn-success" text="ðŸ’¾ LÆ°u ghi chÃº" />
                                </HBox>
                            </VBox>
                        </Tab>
                    </tabs>
                </TabPane>
            </items>
        </SplitPane>
    </center>

    <bottom>
        <VBox>
            <Separator />
        </VBox>
    </bottom>
</BorderPane>
