<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.ProgressIndicator?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.layout.VBox?>

<BorderPane prefHeight="800.0" prefWidth="1200.0" styleClass="main-container" stylesheets="@../../css/main.css,@../../css/forms.css,@../../css/buttons.css,@../../css/layouts.css,@../../css/tables.css,@../../css/financial-report.css,@../../css/navigation.css" xmlns="http://javafx.com/javafx/24.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="org.example.oop.Control.Schedule.AppointmentBookingController">

   <!-- TOP: Header -->
   <top>
      <VBox>
         <!-- Navigation Bar -->
         <HBox alignment="CENTER_LEFT" spacing="8" style="-fx-padding: 12px 20px;" styleClass="navigation-bar">
            <Button fx:id="backButton" onAction="#handleBackButton" styleClass="nav-button nav-back-button" text="â—€ Quay láº¡i" />
            <Button fx:id="forwardButton" onAction="#handleForwardButton" styleClass="nav-button nav-forward-button" text="Tiáº¿n â–¶" />
            <Button fx:id="reloadButton" onAction="#handleReloadButton" styleClass="nav-button nav-reload-button" text="âŸ³ Táº£i láº¡i" />
         </HBox>
         <HBox alignment="CENTER_LEFT" spacing="18.0" styleClass="financial-header">
            <padding>
               <Insets bottom="18.0" left="28.0" right="28.0" top="18.0" />
            </padding>
            <Label styleClass="page-title" text="Äáº¶T Lá»ŠCH KHÃM" />
            <Region HBox.hgrow="ALWAYS" />
            <TextField fx:id="patientQuickSearch" prefWidth="250.0" promptText="TÃ¬m bá»‡nh nhÃ¢n (TÃªn/Email/SÄT)" styleClass="text-field" />
            <Button fx:id="btnNewPatient" mnemonicParsing="false" onAction="#onNewPatient" prefHeight="49.0" prefWidth="214.0" styleClass="btn-success" text="âž• ThÃªm bá»‡nh nhÃ¢n" />
            <ComboBox fx:id="cboCurrentUser" prefWidth="200.0" styleClass="combo-rounded" />
         </HBox>
         <Separator />
      </VBox>
   </top>

   <!-- CENTER: Main Content with Tabs -->
   <center>
      <TabPane styleClass="financial-tabs" tabClosingPolicy="UNAVAILABLE" BorderPane.alignment="CENTER">
         <tabs>
            <!-- Tab 1: Chá»n bá»‡nh nhÃ¢n -->
            <Tab text="ðŸ‘¥ Chá»n bá»‡nh nhÃ¢n">
               <VBox spacing="16.0">
                  <padding>
                     <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
                  </padding>

                  <HBox spacing="16.0" VBox.vgrow="ALWAYS">
                     <!-- Left: Patient List -->
                     <VBox spacing="12.0" HBox.hgrow="ALWAYS">
                        <Label styleClass="form-label" text="Danh sÃ¡ch bá»‡nh nhÃ¢n:" />
                        <TextField fx:id="txtPatientKeyword" promptText="ðŸ” TÃ¬m tÃªn/SÄT" styleClass="text-field" />
                        <TableView fx:id="tblPatients" styleClass="financial-table" VBox.vgrow="ALWAYS">
                           <columns>
                              <TableColumn prefWidth="200.0" text="TÃªn bá»‡nh nhÃ¢n" />
                              <TableColumn prefWidth="120.0" text="Sá»‘ Ä‘iá»‡n thoáº¡i" />
                              <TableColumn prefWidth="100.0" text="NÄƒm sinh" />
                              <TableColumn prefWidth="150.0" text="Email" />
                           </columns>
                        </TableView>
                        <Button fx:id="btnSelectPatient" maxWidth="Infinity" mnemonicParsing="false" onAction="#onSelectPatient" prefHeight="40.0" styleClass="btn-success" text="âœ“ Chá»n bá»‡nh nhÃ¢n nÃ y" />
                     </VBox>

                     <!-- Right: Patient Details -->
                     <VBox prefWidth="400.0" spacing="12.0">
                        <Label styleClass="form-label" text="ThÃ´ng tin chi tiáº¿t:" />
                        <GridPane hgap="12.0" vgap="12.0">
                           <columnConstraints>
                              <ColumnConstraints halignment="RIGHT" minWidth="90.0" />
                              <ColumnConstraints hgrow="ALWAYS" />
                           </columnConstraints>
                           <rowConstraints>
                              <RowConstraints />
                              <RowConstraints />
                              <RowConstraints />
                              <RowConstraints />
                              <RowConstraints />
                           </rowConstraints>

                           <Label styleClass="form-label" text="Há» tÃªn:" GridPane.rowIndex="0" />
                           <TextField fx:id="txtPatientName" editable="false" styleClass="text-field" GridPane.columnIndex="1" GridPane.rowIndex="0" />

                           <Label styleClass="form-label" text="SÄT:" GridPane.rowIndex="1" />
                           <TextField fx:id="txtPatientPhone" editable="false" styleClass="text-field" GridPane.columnIndex="1" GridPane.rowIndex="1" />

                           <Label styleClass="form-label" text="Email:" GridPane.rowIndex="2" />
                           <TextField fx:id="txtPatientEmail" editable="false" styleClass="text-field" GridPane.columnIndex="1" GridPane.rowIndex="2" />

                           <Label styleClass="form-label" text="Báº£o hiá»ƒm:" GridPane.rowIndex="3" />
                           <TextField fx:id="txtPatientInsurance" editable="false" styleClass="text-field" GridPane.columnIndex="1" GridPane.rowIndex="3" />

                           <Label styleClass="form-label" text="Ghi chÃº:" GridPane.rowIndex="4" GridPane.valignment="TOP">
                              <padding><Insets top="8.0" /></padding>
                           </Label>
                           <TextArea fx:id="txtPatientNotes" editable="false" prefRowCount="4" styleClass="text-area" GridPane.columnIndex="1" GridPane.rowIndex="4" />
                        </GridPane>
                     </VBox>
                  </HBox>
               </VBox>
            </Tab>

            <!-- Tab 2: Äáº·t lá»‹ch khÃ¡m -->
            <Tab text="ðŸ“… Äáº·t lá»‹ch khÃ¡m">
               <VBox spacing="12.0">
                  <padding>
                     <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
                  </padding>

                  <!-- Appointment Form - 2 Rows with larger size -->
                  <GridPane hgap="20.0" vgap="16.0" styleClass="form-container">
                     <padding>
                        <Insets bottom="18.0" left="22.0" right="22.0" top="18.0" />
                     </padding>
                     <columnConstraints>
                        <ColumnConstraints halignment="RIGHT" minWidth="100.0" />
                        <ColumnConstraints hgrow="ALWAYS" prefWidth="300.0" />
                        <ColumnConstraints halignment="RIGHT" minWidth="100.0" />
                        <ColumnConstraints hgrow="ALWAYS" prefWidth="300.0" />
                     </columnConstraints>
                     <rowConstraints>
                        <RowConstraints minHeight="52.0" prefHeight="52.0" />
                        <RowConstraints minHeight="52.0" prefHeight="52.0" />
                     </rowConstraints>

                     <Label styleClass="form-label" text="BÃ¡c sÄ©:" style="-fx-font-size: 15px;" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                     <ComboBox fx:id="cboDoctor" maxWidth="Infinity" onAction="#handleDoctorSelection" styleClass="combo-rounded" GridPane.columnIndex="1" GridPane.rowIndex="0" />

                     <Label styleClass="form-label" text="NgÃ y khÃ¡m:" style="-fx-font-size: 15px;" GridPane.columnIndex="2" GridPane.rowIndex="0" />
                     <DatePicker fx:id="dpDate" maxWidth="Infinity" onAction="#handleDateSelection" GridPane.columnIndex="3" GridPane.rowIndex="0" />

                     <Label styleClass="form-label" text="Loáº¡i khÃ¡m:" style="-fx-font-size: 15px;" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                     <ComboBox fx:id="cboVisitType" maxWidth="Infinity" onAction="#handleVisitTypeSelection" styleClass="combo-rounded" GridPane.columnIndex="1" GridPane.rowIndex="1" />

                     <Label styleClass="form-label" text="Ghi chÃº:" style="-fx-font-size: 15px;" GridPane.columnIndex="2" GridPane.rowIndex="1" />
                     <TextField fx:id="txtNotes" promptText="Ghi chÃº..." styleClass="text-field" GridPane.columnIndex="3" GridPane.rowIndex="1" />
                  </GridPane>

                  <Separator />

                  <!-- Available Slots and Doctor Agenda - MUCH LARGER -->
                  <HBox spacing="16.0" VBox.vgrow="ALWAYS" prefHeight="480.0">
                     <!-- Available Slots -->
                     <VBox spacing="10.0" HBox.hgrow="ALWAYS">
                        <Label styleClass="form-label" text="CÃ¡c khung giá» trá»‘ng:" style="-fx-font-size: 16px; -fx-font-weight: 700;" />
                        <TableView fx:id="tblAvailableSlots" styleClass="financial-table" VBox.vgrow="ALWAYS">
                           <columns>
                              <TableColumn prefWidth="110.0" text="Báº¯t Ä‘áº§u" />
                              <TableColumn prefWidth="110.0" text="Káº¿t thÃºc" />
                              <TableColumn prefWidth="90.0" text="KÃ©o dÃ i" />
                              <TableColumn prefWidth="100.0" text="PhÃ²ng" />
                              <TableColumn prefWidth="110.0" text="Tráº¡ng thÃ¡i" />
                           </columns>
                        </TableView>
                     </VBox>

                     <!-- Doctor Agenda -->
                     <VBox spacing="10.0" HBox.hgrow="ALWAYS">
                        <Label styleClass="form-label" text="Lá»‹ch cá»§a bÃ¡c sÄ©:" style="-fx-font-size: 16px; -fx-font-weight: 700;" />
                        <TableView fx:id="tblDoctorAgenda" styleClass="financial-table" VBox.vgrow="ALWAYS">
                           <columns>
                              <TableColumn prefWidth="100.0" text="Giá»" />
                              <TableColumn prefWidth="150.0" text="Bá»‡nh nhÃ¢n" />
                              <TableColumn prefWidth="110.0" text="Loáº¡i khÃ¡m" />
                              <TableColumn prefWidth="110.0" text="Tráº¡ng thÃ¡i" />
                           </columns>
                        </TableView>
                     </VBox>
                  </HBox>

                  <Separator />

                  <!-- Action Buttons - Larger -->
                  <HBox alignment="CENTER_RIGHT" spacing="16.0">
                     <Button fx:id="btnCheck" mnemonicParsing="false" onAction="#onCheckSchedule" prefHeight="48.0" prefWidth="170.0" styleClass="btn-secondary" text="ðŸ” Kiá»ƒm tra lá»‹ch" style="-fx-font-size: 14px;" />
                     <Button fx:id="btnBook" defaultButton="true" disable="true" mnemonicParsing="false" onAction="#onBookAppointment" prefHeight="48.0" prefWidth="170.0" styleClass="btn-success" text="ðŸ“… Äáº·t lá»‹ch" style="-fx-font-size: 14px;" />
                     <Button fx:id="btnClear" mnemonicParsing="false" onAction="#onClearForm" prefHeight="48.0" prefWidth="140.0" styleClass="btn-secondary" text="ðŸ”„ LÃ m má»›i" style="-fx-font-size: 14px;" />
                  </HBox>
               </VBox>
            </Tab>

            <!-- Tab 3: Lá»‹ch bÃ¡c sÄ© -->
            <Tab text="ðŸ“† Lá»‹ch bÃ¡c sÄ©">
               <VBox spacing="16.0">
                  <padding>
                     <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
                  </padding>

                  <HBox alignment="CENTER_LEFT" spacing="14.0">
                     <Label styleClass="form-label" text="Chá»n ngÃ y xem lá»‹ch:" />
                     <DatePicker fx:id="dpQuickJump" prefWidth="200.0" />
                     <Region HBox.hgrow="ALWAYS" />
                     <Button fx:id="btnOpenCalendar" mnemonicParsing="false" onAction="#onOpenCalendar" prefWidth="140.0" styleClass="btn-secondary" text="ðŸ“… Má»Ÿ lá»‹ch Ä‘áº§y Ä‘á»§" />
                  </HBox>

                  <Separator />

                  <ListView fx:id="lvwDayAgenda" styleClass="financial-table" VBox.vgrow="ALWAYS" />
               </VBox>
            </Tab>
         </tabs>
      </TabPane>
   </center>

   <!-- BOTTOM: Removed to maximize table space -->
</BorderPane>
